<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>FUNCTIONS TO FIT NON-LINEAR MODELS TO ESTIMATE MAXB Wrapper function to fit non-linear growth model per species. — fitNLMModels • LandR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="FUNCTIONS TO FIT NON-LINEAR MODELS TO ESTIMATE MAXB Wrapper function to fit non-linear growth model per species. — fitNLMModels"><meta property="og:description" content="The function will create sensible parameter ranges for A, k and p parameters
of the Chapman-Richards and Logistic growth curves and attempt to run a
forward step-AIC procedure to add covariates to the linear component of the
model (on the A parameter -- the asymptote). The maximum number of covariates
to add is determined by maxNoCoefs."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-58633549-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-58633549-5');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LandR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/PredictiveEcology/LandR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>FUNCTIONS TO FIT NON-LINEAR MODELS TO ESTIMATE MAXB Wrapper function to fit non-linear growth model per species.</h1>
    <small class="dont-index">Source: <a href="https://github.com/PredictiveEcology/LandR/blob/HEAD/R/maxBestimation.R" class="external-link"><code>R/maxBestimation.R</code></a></small>
    <div class="hidden name"><code>fitNLMModels.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function will create sensible parameter ranges for A, k and p parameters
of the Chapman-Richards and Logistic growth curves and attempt to run a
forward step-AIC procedure to add covariates to the linear component of the
model (on the A parameter -- the asymptote). The maximum number of covariates
to add is determined by <code>maxNoCoefs</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fitNLMModels</span><span class="op">(</span></span>
<span>  sp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">predictorVarsData</span>,</span>
<span>  <span class="va">sppVarsB</span>,</span>
<span>  <span class="va">predictorVars</span>,</span>
<span>  predictorVarsCombos <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  maxNoCoefs <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  doFwdSelection <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sampleSize <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>  Ntries <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  maxCover <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"Logistic"</span><span class="op">)</span>,</span>
<span>  modelOutputsPrev <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  randomStarts <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  lowerBounds <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  upperBounds <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  nbWorkers <span class="op">=</span> <span class="fl">1L</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>sp</dt>
<dd><p>species name -- only used for messaging.</p></dd>


<dt>predictorVarsData</dt>
<dd><p>a <code>data.table</code> of predictor variables including
those in <code>predictorVars</code> and <code>age</code>, as well as <code>pixelIndex</code>.
Note that <code>age</code> should be in the original scale (e.g., not logged).</p></dd>


<dt>sppVarsB</dt>
<dd><p>s <code>data.table</code> of species biomass (<code>B</code>) and <code>pixelIndex</code>.</p></dd>


<dt>predictorVars</dt>
<dd><p>character vector of predictor variables to be included
in the linear component of the model affecting the asymptote (need to correspond to
<code>names(predictorVarsData[[sp]])</code>) the same predictors will be considered for all
species.</p></dd>


<dt>predictorVarsCombos</dt>
<dd><p>a list of sets of covariates in <code>predictorVars</code> to add to
the fitted models. If this list has several entries with sets of covariates,
each will be fitted as part of the model selection process.</p></dd>


<dt>maxNoCoefs</dt>
<dd><p>how many covariates from <code>predictorVars</code> should be added to
the linear component of the model affecting the asymptote? Note that the
more covariates are added the longer the model takes to fit, as all
combinations are attempted. For 2 or more covariates, only combinations with
"cover" are attempted.</p></dd>


<dt>doFwdSelection</dt>
<dd><p>should covariates be added one at a time to the
linear component of the model? If <code>TRUE</code>, and <code>is.null(predictorVarsCombos)</code>,
then each entry in <code>predictorVarsCombos</code> is used as the set of covariates to
test. Otherwise, <code>predictorVarsCombos</code> will be created from combinations of
<code>predictorVars</code>, with <code>maxNoCoefs</code> determining the maximum number of covariates
to add. If <code>FALSE</code> the full model is fitted.</p></dd>


<dt>sampleSize</dt>
<dd><p>how many data points should be randomly sampled to fit the model?
If <code>NA</code> the full dataset will be used. Note that this may result in long
computation times. Biomass data will be binned into 10 regular bins before sampling points in number
equal to <code>sampleSize</code>.</p></dd>


<dt>Ntries</dt>
<dd><p>how many times should the models be fit with new randomly
generated starting values? Only used if <code>randomStarts == TRUE</code>.</p></dd>


<dt>maxCover</dt>
<dd><p>numeric. Value indicating maximum cover/dominance.</p></dd>


<dt>models</dt>
<dd><p>character vector of models to fit. Only Chapman-Richards ('CR')
and 'Logistic' can be chosen at the moment.</p></dd>


<dt>modelOutputsPrev</dt>
<dd><p>previous outputs of <code>fitNLMmodels</code>. The model will try
refitting and comparing AIC with the last results.</p></dd>


<dt>randomStarts</dt>
<dd><p>logical. Should random starting values of A, k and p non-linear
parameters be picked from a range sensible values, or should all combinations
of values within this range be used? If FALSE, the default, the starting values
are spaced at regular intervals within an acceptable range for each parameter -- 20
values for A, 10 for k and p -- and all combinations are used (2000 starting
values in total). Parameter ranges are estimated from data following Fekedulegn et al. (1999)
as follows:</p><ul><li><p>range of <code>A</code> starting values (B0 parameter in Fekedulegn et al. 1999)
varies between \(ObsMaxB \times 0.3\) and \(ObsMaxB \times 0.9\), where $$ObsMaxB$$ is
the maximum observed B across the full dataset (not the sampled data for fitting)</p></li>
<li><p><code>k</code> (CR model) and <code>p</code> (Logistic model; both are <code>B2</code> parameter in
Fekedulegn et al. 1999) are estimated as a constant rate to get to $$ObsMaxB$$,
calculated as \(\frac{\frac{Bobs2 - Bobs1}{age2 - age1}}{ObsMaxB}\),
where <code>B1</code>/<code>B2</code> and <code>age1</code>/<code>age2</code> are are observed values at two points in time.
We draw 100 samples of two <code>age</code> values, and corresponding <code>B</code>,
to calculate a sample of rates.
After excluding rates &lt;= 0, we take the minimum and maximum values as
the range of <code>k</code> (CR model) or <code>p</code> (Logistic model) parameters of the growth model</p></li>
<li><p>the <code>p</code> parameter (CR model) (related to <code>B3</code> parameter in Fekedulegn
et al. 1999) should be &gt; 1. Here we use a range of values between 1.1 and
80 which provided suitable fitting using data from the Northwest Territories,
Canada</p></li>
<li><p>the <code>k</code> parameter (Logistic model; B1 parameter in Fekedulegn et al. 1999)
is estimated as \(B_0 = \frac{ObsMaxB}{1 + k}\), using a small positive
number for \(B_0\), e.g. 2. Here, we estimate <code>k</code> values for \(B_0\)
values 1 to 5, and use the minimum and maximum to determine the range from
where to draw starting values.</p></li>
</ul></dd>


<dt>lowerBounds</dt>
<dd><p>a named vector of lower parameter boundaries. If <code>FALSE</code>, no lower
boundaries are applied. If <code>TRUE</code>, coefficients of the linear model on the <code>A</code>
parameter (<code>intercept</code>, <code>cover</code>, <code>k</code> and <code>p</code>) are bound
(<code>intercept = observed maximum B * 0.5</code>, <code>cover = 0</code>, <code>k = 0.05</code> and <code>p = 1</code>).
Alternatively, pass a named vector of parameter boundaries.</p></dd>


<dt>upperBounds</dt>
<dd><p>a named vector of upper parameter boundaries. If <code>FALSE</code>, no lower
boundaries are applied. If <code>TRUE</code>, coefficient of the linear model on the A parameter
(<code>intercept</code> and <code>k</code>) are bound (<code>intercept = observed maximum B * 1.5</code>, <code>k = 0.2</code>).
Alternatively, pass a named vector of parameter boundaries.</p></dd>


<dt>nbWorkers</dt>
<dd><p>integer. If &gt; 1, the number of workers to use in <code><a href="https://future.apply.futureverse.org/reference/future_apply.html" class="external-link">future.apply::future_apply</a></code>, otherwise
no parallellisation is done.</p></dd>

</dl></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/bbmle/man/mle2.html" class="external-link">bbmle::mle2()</a></code></p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Eliot J B McIntire, Alex M Chubaty, Ceres Barros, Ian M S Eddy.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

